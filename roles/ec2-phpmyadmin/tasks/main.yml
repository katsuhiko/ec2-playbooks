---
- name: Upgrade all packages
  yum: name=* state=latest

- name: Install httpd
  yum: name={{ item }} state=latest
  with_items:
    - httpd24
    - mod24_ssl

- name: Put httpd.conf
  template: src=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf backup=true mode=0644
  notify: restart httpd

- name: Disable welcome site
  command: mv -f /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.backup removes=/etc/httpd/conf.d/welcome.conf
  notify: restart httpd
  when: not httpd_welcome_site_enabled

- name: Set httpd service to start on boot
  service: name=httpd enabled=true

- name: Install php
  yum: name={{ item }} state=latest
  with_items:
    - php55

- name: Put php.ini
  template: src=php-5.5.ini.j2 dest=/etc/php-5.5.ini backup=true mode=0644
  notify: restart httpd

- name: Install phpmyadmin
  yum: name=phpmyadmin state=latest enablerepo=epel

- name: Put phpMyAmin.conf
  template: src=phpMyAdmin.conf.j2 dest=/etc/httpd/conf.d/phpMyAdmin.conf backup=true mode=0644
  notify: restart httpd

- name: Put config.inc.php
  template: src=phpMyAdmin.config.inc.php.j2 dest=/etc/phpMyAdmin/config.inc.php backup=true mode=0640
  notify: restart httpd
